#!/bin/bash

# Define the output CSV file
csv_file="pokemon_report.csv"

# Add a header to the CSV file
echo "Name,Height (m),Weight (kg)" > "$csv_file"

# Loop through all JSON files in the current directory
for file in *.json; do
    # Skip if no JSON files found
    [ -e "$file" ] || continue
    
    # Extract name and capitalize the first letter
    name=$(jq -r '.name' "$file" | sed 's/./\u&/')
    
    # Extract height and weight, dividing by 10 to convert to m and kg
    height=$(jq -r '.height / 10' "$file")
    weight=$(jq -r '.weight / 10' "$file")
    
    # Append the data to the CSV file
    echo "$name,$height,$weight" >> "$csv_file"
done

# Print the generation message
echo "CSV Report generated at: $csv_file"
echo ""

# Display the content of the CSV file
cat "$csv_file"
echo ""

# Use awk to calculate the average height and weight from the CSV file
awk -F, '
    NR > 1 {
        total_height += $2
        total_weight += $3
        count++
    }
    END {
        if (count > 0) {
            avg_height = total_height / count
            avg_weight = total_weight / count
            # Format output to 2 decimal places (implied by example)
            printf "Average Height: %.2f m\n", avg_height
            printf "Average Weight: %.2f kg\n", avg_weight
        } else {
            print "No data found."
        }
    }
' "$csv_file"
