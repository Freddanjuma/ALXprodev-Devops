#!/bin/bash

# Define the list of Pokemon
pokemon_list=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

for pokename in "${pokemon_list[@]}"; do
    echo "Fetching data for $pokename..."
    
    # Retry mechanism variables
    attempt=0
    max_retries=3
    success=false

    # Retry loop: Run up to 3 times
    while [ $attempt -lt $max_retries ]; do
        # Try to fetch the data
        if curl -s -f "https://pokeapi.co/api/v2/pokemon/$pokename" -o "${pokename}.json"; then
            echo "Successfully saved to ${pokename}.json"
            success=true
            break  # Exit the retry loop on success
        else
            attempt=$((attempt + 1))
            echo "Attempt $attempt failed. Retrying..."
            sleep 1
        fi
    done

    # If all 3 attempts failed, log the error
    if [ "$success" = false ]; then
        echo "Failed to fetch data for $pokename after $max_retries attempts." >> errors.txt
    fi
    
    # Delay between pokemon to handle rate limiting
    sleep 2
done
